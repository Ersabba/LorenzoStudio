function getServerClock() {
    try {
        timeoutCallServerClock = window.setTimeout("getServerClock()", 300), null == document.getElementById("serverClock") ? (log("Elemento serverClock non trovato, me lo creo..."), document.createElement("P"), document.getElementById("serverClock").value = addZero(ServerDate.getHours()) + ":" + addZero(ServerDate.getMinutes()) + ":" + addZero(ServerDate.getSeconds())) : $("#serverClock").val(addZero(ServerDate.getHours()) + ":" + addZero(ServerDate.getMinutes()) + ":" + addZero(ServerDate.getSeconds()))
    } catch (e) {
        $("#errServerClock").html("Error to synchronization server's clock."), $("#errClockHidden").val(e), clearTimeout(timeoutCallServerClock), clearInterval(synchronizationInterval)
    }
}

function addZero(e) {
    return 10 > e && (e = "0" + e), e
}

function CreateHTTPRequestObject() {
    var e = window.ActiveXObject && "file:" === location.protocol;
    if (window.XMLHttpRequest && !e) return new XMLHttpRequest;
    try {
        return new ActiveXObject("Microsoft.XMLHTTP")
    } catch (t) {
    }
    return logError("Your browser doesn't support XML handling!"), null
}

function IsRequestSuccessful(e) {
    var t = 0 == e.status || e.status >= 200 && e.status < 300 || 304 == e.status || 1223 == e.status;
    return t
}

var debug = 0, iterationSync = 5, timeoutCallServerClock, ServerDate = function (e) {
    function t() {
        return this ? t : t.toString()
    }

    function n(e, t) {
        this.value = e, this.precision = t
    }

    function o(e) {
        var n, o = "Set target to " + String(e);
        f && (o += " (" + (e > f ? "+" : "-") + " " + Math.abs(e - f) + " ms)"), f = e, i(o + "."), n = Math.abs(f - d), n > t.amortizationThreshold && (i("Difference between target and offset too high (" + n + " ms); skipping amortization."), d = f)
    }

    function r(e) {
        if (e) {
            var t = e.getResponseHeader("Content-Type"), n = e.getResponseHeader("Content-Length"),
                o = e.getResponseHeader("Last-Modified"), r = e.getResponseHeader("Date");
            i("Content-Type: " + t + "\nContent-Length: " + n + "\nLast-Modified: " + o + "\nServer Date: " + r)
        } else i("httpRequest nulla!")
    }

    function a() {
        function e() {
            var e = null;
            if (e || (e = CreateHTTPRequestObject()), e) {
                var n = v + Date.now();
                e.open("GET", n, !0), e.onreadystatechange = function () {
                    (0 == e.readyState || 4 == e.readyState) && (IsRequestSuccessful(e) ? (debug && r(e), c = new Date, t(new Date(e.getResponseHeader("Date")).getTime())) : s("httpRequest failed."))
                }
            }
            a = Date.now(), e.send()
        }

        function t(t) {
            var r = (c - a) / 2, s = new n(t + r - c, r);
            i("sample: " + u + ", offset: " + String(s)), (1 == u || r <= l.precision) && (l = s), iterationSync > u ? (u++, e()) : (o(l), m = !1)
        }

        var a, c, l, u = 1;
        m || (m = !0, setTimeout(function () {
            m = !1
        }, 1e4), e())
    }

    function i(e) {
        console && console.log && 1 == debug && console.log("[ServerDate] " + e)
    }

    function s(e) {
        console && console.error ? console.error("[ServerDate] " + e) : alert("Error: " + e)
    }

    var c, l, u, d, g = Date.now(), v = "/basic-struts/mgse/web/2016/script/ServerDate.min.js?noCache=", f = null,
        m = !1;
    t.parse = Date.parse, t.UTC = Date.UTC, t.now = function () {
        return Date.now() + d
    };
    var h = ["toString", "toDateString", "toTimeString", "toLocaleString", "toLocaleDateString", "toLocaleTimeString", "valueOf", "getTime", "getFullYear", "getUTCFullYear", "getMonth", "getUTCMonth", "getDate", "getUTCDate", "getDay", "getUTCDay", "getHours", "getUTCHours", "getMinutes", "getUTCMinutes", "getSeconds", "getUTCSeconds", "getMilliseconds", "getUTCMilliseconds", "getTimezoneOffset", "toUTCString", "toISOString", "toJSON"];
    $.each(h, function (e, n) {
        t[n] = function () {
            return new Date(t.now())[n]()
        }
    }), t.getPrecision = function () {
        return "undefined" != typeof f.precision ? f.precision + Math.abs(f - d) : void 0
    }, t.amortizationRate = 25, t.amortizationThreshold = 2e3;
    try {
        Object.defineProperty(t, "synchronizationIntervalDelay", {
            get: function () {
                return c
            }, set: function (e) {
                c = e, clearInterval(l), l = setInterval(a, t.synchronizationIntervalDelay), i("Set synchronizationIntervalDelay to " + e + " ms.")
            }
        })
    } catch (S) {
        var c = 36e5;
        i("Object.defineProperty non supportato ma gestito. Set synchronizationIntervalDelay to " + c + " ms."), clearInterval(l), l = setInterval(a, c)
    }
    return t.synchronizationIntervalDelay = 36e5, n.prototype.valueOf = function () {
        return this.value
    }, n.prototype.toString = function () {
        return this.value + ("undefined" != typeof this.precision ? " +/- " + this.precision : "") + " ms"
    }, d = e - g, "undefined" != typeof performance && (u = (g - performance.timing.domLoading) / 2, d += u), o(new n(d, u)), setInterval(function () {
        var e = Math.max(-t.amortizationRate, Math.min(t.amortizationRate, f - d));
        d += e, e && i("Offset adjusted by " + e + " ms to " + d + " ms (target: " + f.value + " ms).")
    }, 1e3), document.addEventListener || window.addEventListener ? (window.addEventListener("pageshow", a), i("addEventListener ok")) : (document.attachEvent || window.attachEvent) && (window.attachEvent("onload", a), i("attachEvent ok")), a(), t
}(Date.now());